<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Last Observation Carried Forward — na_locf • na.actions</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">na.actions</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/decisionpatterns/na.actions">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Last Observation Carried Forward</h1>
    </div>

    
    <p>Generic function for replacing each <code>NA</code> with the most recent
non-<code>NA</code> prior to it.</p>
    

    <pre class="usage"><span class='fu'>na_locf</span>(<span class='no'>object</span>, <span class='kw'>na_rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)

<span class='co'># S3 method for default</span>
<span class='fu'>na_locf</span>(<span class='no'>object</span>, <span class='kw'>na_rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>fromLast</span>, <span class='no'>rev</span>, <span class='kw'>maxgap</span> <span class='kw'>=</span> <span class='fl'>Inf</span>,
  <span class='kw'>rule</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='no'>...</span>)

<span class='fu'>na_contiguous.data.frame</span>(<span class='no'>object</span>, <span class='no'>...</span>)

<span class='fu'>na_contiguous.list</span>(<span class='no'>object</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>an object.</p></td>
    </tr>
    <tr>
      <th>na_rm</th>
      <td><p>logical. Should leading <code>NA</code>s be removed?</p></td>
    </tr>
    <tr>
      <th>&#8230;</th>
      <td><p>further arguments passed to methods.</p></td>
    </tr>
    <tr>
      <th>fromLast</th>
      <td><p>logical. Causes observations to be carried backward rather
than forward.  Default is <code>FALSE</code>.  With a value of <code>TRUE</code> this
corresponds to NOCB (next observation carried backward).  It is not
supported if <code>x</code> or <code>xout</code> is specified.</p></td>
    </tr>
    <tr>
      <th>rev</th>
      <td><p>Use <code>fromLast</code> instead.  This argument will be eliminated in
the future in favor of <code>fromLast</code>.</p></td>
    </tr>
    <tr>
      <th>maxgap</th>
      <td><p>Runs of more than <code>maxgap</code> <code>NA</code>s are retained, other
<code>NA</code>s are removed and the last occurrence in the resulting series prior
to each time point in <code>xout</code> is used as that time point's output value.
(If <code>xout</code> is not specified this reduces to retaining runs of more than
<code>maxgap</code> <code>NA</code>s while filling other <code>NA</code>s with the last
occurrence of a non-<code>NA</code>.)</p></td>
    </tr>
    <tr>
      <th>rule</th>
      <td><p>See <code>approx</code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object in which each <code>NA</code> in the input object is replaced by
the most recent non-<code>NA</code> prior to it.  If there are no earlier
non-<code>NA</code>s then the <code>NA</code> is omitted (if <code>na_rm = TRUE</code>) or it
is not replaced (if <code>na_rm = FALSE</code>).</p>
<p>The arguments <code>x</code> and <code>xout</code> can be used in which case they have
the same meaning as in <code>approx</code>.</p>
<p>Note that if a multi-column zoo object has a column entirely composed of
<code>NA</code> then with <code>na_rm = TRUE</code>, the default, the above implies that
the resulting object will have zero rows. Use <code>na_rm = FALSE</code> to
preserve the <code>NA</code> values instead.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code>zoo</code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='no'>az</span> <span class='kw'>&lt;-</span> <span class='fu'>zoo</span>(<span class='fl'>1</span>:<span class='fl'>6</span>)

<span class='no'>bz</span> <span class='kw'>&lt;-</span> <span class='fu'>zoo</span>(<span class='fu'>c</span>(<span class='fl'>2</span>,<span class='fl'>NA</span>,<span class='fl'>1</span>,<span class='fl'>4</span>,<span class='fl'>5</span>,<span class='fl'>2</span>))
<span class='fu'>na_locf</span>(<span class='no'>bz</span>)</div><div class='output co'>#&gt; 1 2 3 4 5 6 
#&gt; 2 2 1 4 5 2 </div><div class='input'><span class='fu'>na_locf</span>(<span class='no'>bz</span>, <span class='kw'>fromLast</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; 1 2 3 4 5 6 
#&gt; 2 1 1 4 5 2 </div><div class='input'>
<span class='no'>cz</span> <span class='kw'>&lt;-</span> <span class='fu'>zoo</span>(<span class='fu'>c</span>(<span class='fl'>NA</span>,<span class='fl'>9</span>,<span class='fl'>3</span>,<span class='fl'>2</span>,<span class='fl'>3</span>,<span class='fl'>2</span>))
<span class='fu'>na_locf</span>(<span class='no'>cz</span>)</div><div class='output co'>#&gt; 2 3 4 5 6 
#&gt; 9 3 2 3 2 </div><div class='input'>
<span class='co'># generate and fill in missing dates</span>
<span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='fu'>zoo</span>(<span class='fu'>c</span>(<span class='fl'>0.007306621</span>, <span class='fl'>0.007659046</span>, <span class='fl'>0.007681013</span>,
        <span class='fl'>0.007817548</span>, <span class='fl'>0.007847579</span>, <span class='fl'>0.007867313</span>),
        <span class='fu'>as.Date</span>(<span class='fu'>c</span>(<span class='st'>"1993-01-01"</span>, <span class='st'>"1993-01-09"</span>, <span class='st'>"1993-01-16"</span>,
        <span class='st'>"1993-01-23"</span>, <span class='st'>"1993-01-30"</span>, <span class='st'>"1993-02-06"</span>)))
<span class='no'>g</span> <span class='kw'>&lt;-</span> <span class='fu'>seq</span>(<span class='fu'>start</span>(<span class='no'>z</span>), <span class='fu'>end</span>(<span class='no'>z</span>), <span class='st'>"day"</span>)
<span class='fu'>na_locf</span>(<span class='no'>z</span>, <span class='kw'>xout</span> <span class='kw'>=</span> <span class='no'>g</span>)</div><div class='output co'>#&gt;  1993-01-01  1993-01-02  1993-01-03  1993-01-04  1993-01-05  1993-01-06 
#&gt; 0.007306621 0.007306621 0.007306621 0.007306621 0.007306621 0.007306621 
#&gt;  1993-01-07  1993-01-08  1993-01-09  1993-01-10  1993-01-11  1993-01-12 
#&gt; 0.007306621 0.007306621 0.007659046 0.007659046 0.007659046 0.007659046 
#&gt;  1993-01-13  1993-01-14  1993-01-15  1993-01-16  1993-01-17  1993-01-18 
#&gt; 0.007659046 0.007659046 0.007659046 0.007681013 0.007681013 0.007681013 
#&gt;  1993-01-19  1993-01-20  1993-01-21  1993-01-22  1993-01-23  1993-01-24 
#&gt; 0.007681013 0.007681013 0.007681013 0.007681013 0.007817548 0.007817548 
#&gt;  1993-01-25  1993-01-26  1993-01-27  1993-01-28  1993-01-29  1993-01-30 
#&gt; 0.007817548 0.007817548 0.007817548 0.007817548 0.007817548 0.007847579 
#&gt;  1993-01-31  1993-02-01  1993-02-02  1993-02-03  1993-02-04  1993-02-05 
#&gt; 0.007847579 0.007847579 0.007847579 0.007847579 0.007847579 0.007847579 
#&gt;  1993-02-06 
#&gt; 0.007867313 </div><div class='input'>
<span class='co'># similar but use a 2 second grid</span>

<span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='fu'>zoo</span>(<span class='fl'>1</span>:<span class='fl'>9</span>, <span class='fu'>as.POSIXct</span>(<span class='fu'>c</span>(<span class='st'>"2010-01-04 09:30:02"</span>, <span class='st'>"2010-01-04 09:30:06"</span>,
 <span class='st'>"2010-01-04 09:30:07"</span>, <span class='st'>"2010-01-04 09:30:08"</span>, <span class='st'>"2010-01-04 09:30:09"</span>,
 <span class='st'>"2010-01-04 09:30:10"</span>, <span class='st'>"2010-01-04 09:30:11"</span>, <span class='st'>"2010-01-04 09:30:13"</span>,
 <span class='st'>"2010-01-04 09:30:14"</span>)))

<span class='no'>g</span> <span class='kw'>&lt;-</span> <span class='fu'>seq</span>(<span class='fu'>start</span>(<span class='no'>z</span>), <span class='fu'>end</span>(<span class='no'>z</span>), <span class='kw'>by</span> <span class='kw'>=</span> <span class='st'>"2 sec"</span>)
<span class='fu'>na_locf</span>(<span class='no'>z</span>, <span class='kw'>xout</span> <span class='kw'>=</span> <span class='no'>g</span>)</div><div class='output co'>#&gt; 2010-01-04 09:30:02 2010-01-04 09:30:04 2010-01-04 09:30:06 2010-01-04 09:30:08 
#&gt;                   1                   1                   2                   4 
#&gt; 2010-01-04 09:30:10 2010-01-04 09:30:12 2010-01-04 09:30:14 
#&gt;                   6                   7                   9 </div><div class='input'>
<span class='co'>## get 5th of every month or most recent date prior to 5th if 5th missing.</span>
<span class='co'>## Result has index of the date actually used.</span>

<span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='fu'>zoo</span>(<span class='fu'>c</span>(<span class='fl'>1311.56</span>, <span class='fl'>1309.04</span>, <span class='fl'>1295.5</span>, <span class='fl'>1296.6</span>, <span class='fl'>1286.57</span>, <span class='fl'>1288.12</span>,
<span class='fl'>1289.12</span>, <span class='fl'>1289.12</span>, <span class='fl'>1285.33</span>, <span class='fl'>1307.65</span>, <span class='fl'>1309.93</span>, <span class='fl'>1311.46</span>, <span class='fl'>1311.28</span>,
<span class='fl'>1308.11</span>, <span class='fl'>1301.74</span>, <span class='fl'>1305.41</span>, <span class='fl'>1309.72</span>, <span class='fl'>1310.61</span>, <span class='fl'>1305.19</span>, <span class='fl'>1313.21</span>,
<span class='fl'>1307.85</span>, <span class='fl'>1312.25</span>, <span class='fl'>1325.76</span>), <span class='fu'>as.Date</span>(<span class='fu'>c</span>(<span class='fl'>13242</span>, <span class='fl'>13244</span>,
<span class='fl'>13245</span>, <span class='fl'>13248</span>, <span class='fl'>13249</span>, <span class='fl'>13250</span>, <span class='fl'>13251</span>, <span class='fl'>13252</span>, <span class='fl'>13255</span>, <span class='fl'>13256</span>, <span class='fl'>13257</span>,
<span class='fl'>13258</span>, <span class='fl'>13259</span>, <span class='fl'>13262</span>, <span class='fl'>13263</span>, <span class='fl'>13264</span>, <span class='fl'>13265</span>, <span class='fl'>13266</span>, <span class='fl'>13269</span>, <span class='fl'>13270</span>,
<span class='fl'>13271</span>, <span class='fl'>13272</span>, <span class='fl'>13274</span>)))

<span class='co'># z.na is same as z but with missing days added (with NAs)</span>
<span class='co'># It is formed by merging z with a zero with series having all the dates.</span>

<span class='no'>rng</span> <span class='kw'>&lt;-</span> <span class='fu'>range</span>(<span class='fu'>time</span>(<span class='no'>z</span>))
<span class='no'>z.na</span> <span class='kw'>&lt;-</span> <span class='fu'>merge</span>(<span class='no'>z</span>, <span class='fu'>zoo</span>(, <span class='fu'>seq</span>(<span class='no'>rng</span>[<span class='fl'>1</span>], <span class='no'>rng</span>[<span class='fl'>2</span>], <span class='kw'>by</span> <span class='kw'>=</span> <span class='st'>"day"</span>)))

<span class='co'># use na_locf to bring values forward picking off 5th of month</span>
<span class='fu'>na_locf</span>(<span class='no'>z.na</span>)[<span class='fu'>as.POSIXlt</span>(<span class='fu'>time</span>(<span class='no'>z.na</span>))$<span class='no'>mday</span> <span class='kw'>==</span> <span class='fl'>5</span>]</div><div class='output co'>#&gt; 2006-04-05 2006-05-05 
#&gt;    1311.56    1312.25 </div><div class='input'>
<span class='co'>## this is the same as the last one except instead of always using the</span>
<span class='co'>## 5th of month in the result we show the date actually used</span>

<span class='co'># idx has NAs wherever z.na does but has 1, 2, 3, ... instead of</span>
<span class='co'># z.na's data values (so idx can be used for indexing)</span>

<span class='no'>idx</span> <span class='kw'>&lt;-</span> <span class='fu'>coredata</span>(<span class='fu'>na_locf</span>(<span class='fu'>seq_along</span>(<span class='no'>z.na</span>) + (<span class='fl'>0</span> * <span class='no'>z.na</span>)))

<span class='co'># pick off those elements of z.na that correspond to 5th</span>

<span class='no'>z.na</span>[<span class='no'>idx</span>[<span class='fu'>as.POSIXlt</span>(<span class='fu'>time</span>(<span class='no'>z.na</span>))$<span class='no'>mday</span> <span class='kw'>==</span> <span class='fl'>5</span>]]</div><div class='output co'>#&gt; 2006-04-04 2006-05-04 
#&gt;    1311.56    1312.25 </div><div class='input'>
<span class='co'>## only fill single-day gaps</span>

<span class='fu'>merge</span>(<span class='no'>z.na</span>, <span class='kw'>filled1</span> <span class='kw'>=</span> <span class='fu'>na_locf</span>(<span class='no'>z.na</span>, <span class='kw'>maxgap</span> <span class='kw'>=</span> <span class='fl'>1</span>))</div><div class='output co'>#&gt;               z.na filled1
#&gt; 2006-04-04 1311.56 1311.56
#&gt; 2006-04-05      NA 1311.56
#&gt; 2006-04-06 1309.04 1309.04
#&gt; 2006-04-07 1295.50 1295.50
#&gt; 2006-04-08      NA      NA
#&gt; 2006-04-09      NA      NA
#&gt; 2006-04-10 1296.60 1296.60
#&gt; 2006-04-11 1286.57 1286.57
#&gt; 2006-04-12 1288.12 1288.12
#&gt; 2006-04-13 1289.12 1289.12
#&gt; 2006-04-14 1289.12 1289.12
#&gt; 2006-04-15      NA      NA
#&gt; 2006-04-16      NA      NA
#&gt; 2006-04-17 1285.33 1285.33
#&gt; 2006-04-18 1307.65 1307.65
#&gt; 2006-04-19 1309.93 1309.93
#&gt; 2006-04-20 1311.46 1311.46
#&gt; 2006-04-21 1311.28 1311.28
#&gt; 2006-04-22      NA      NA
#&gt; 2006-04-23      NA      NA
#&gt; 2006-04-24 1308.11 1308.11
#&gt; 2006-04-25 1301.74 1301.74
#&gt; 2006-04-26 1305.41 1305.41
#&gt; 2006-04-27 1309.72 1309.72
#&gt; 2006-04-28 1310.61 1310.61
#&gt; 2006-04-29      NA      NA
#&gt; 2006-04-30      NA      NA
#&gt; 2006-05-01 1305.19 1305.19
#&gt; 2006-05-02 1313.21 1313.21
#&gt; 2006-05-03 1307.85 1307.85
#&gt; 2006-05-04 1312.25 1312.25
#&gt; 2006-05-05      NA 1312.25
#&gt; 2006-05-06 1325.76 1325.76</div><div class='input'>
<span class='co'>## fill NAs in first column by inflating the most recent non-NA</span>
<span class='co'>## by the growth in second column.  Note that elements of x-x</span>
<span class='co'>## are NA if the corresponding element of x is NA and zero else</span>

<span class='no'>m</span> <span class='kw'>&lt;-</span> <span class='fu'>zoo</span>(<span class='fu'>cbind</span>(<span class='fu'>c</span>(<span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>NA</span>, <span class='fl'>NA</span>, <span class='fl'>5</span>, <span class='fl'>NA</span>, <span class='fl'>NA</span>), <span class='fu'>seq</span>(<span class='fl'>7</span>)^<span class='fl'>2</span>), <span class='fu'>as.Date</span>(<span class='fl'>1</span>:<span class='fl'>7</span>))

<span class='no'>r</span> <span class='kw'>&lt;-</span> <span class='fu'>na_locf</span>(<span class='no'>m</span>[,<span class='fl'>1</span>]) * <span class='no'>m</span>[,<span class='fl'>2</span>] / <span class='fu'>na_locf</span>(<span class='no'>m</span>[,<span class='fl'>2</span>] + (<span class='no'>m</span>[,<span class='fl'>1</span>]-<span class='no'>m</span>[,<span class='fl'>1</span>]))
<span class='fu'>cbind</span>(<span class='kw'>V1</span> <span class='kw'>=</span> <span class='no'>r</span>, <span class='kw'>V2</span> <span class='kw'>=</span> <span class='no'>m</span>[,<span class='fl'>2</span>])</div><div class='output co'>#&gt;             V1 V2
#&gt; 1970-01-02 1.0  1
#&gt; 1970-01-03 2.0  4
#&gt; 1970-01-04 4.5  9
#&gt; 1970-01-05 8.0 16
#&gt; 1970-01-06 5.0 25
#&gt; 1970-01-07 7.2 36
#&gt; 1970-01-08 9.8 49</div><div class='input'>
<span class='co'>## repeat a quarterly value every month</span>
<span class='co'>## preserving NAs</span>
<span class='no'>zq</span> <span class='kw'>&lt;-</span> <span class='fu'>zoo</span>(<span class='fu'>c</span>(<span class='fl'>1</span>, <span class='fl'>NA</span>, <span class='fl'>3</span>, <span class='fl'>4</span>), <span class='fu'>as.yearqtr</span>(<span class='fl'>2000</span>) + <span class='fl'>0</span>:<span class='fl'>3</span>/<span class='fl'>4</span>)
<span class='no'>tt</span> <span class='kw'>&lt;-</span> <span class='fu'>as.yearmon</span>(<span class='fu'>start</span>(<span class='no'>zq</span>)) + <span class='fu'>seq</span>(<span class='fl'>0</span>, <span class='kw'>len</span> <span class='kw'>=</span> <span class='fl'>3</span> * <span class='fu'>length</span>(<span class='no'>zq</span>))/<span class='fl'>12</span>
<span class='fu'>na_locf</span>(<span class='no'>zq</span>, <span class='kw'>xout</span> <span class='kw'>=</span> <span class='no'>tt</span>, <span class='kw'>maxgap</span> <span class='kw'>=</span> <span class='fl'>0</span>)</div><div class='output co'>#&gt; Jan 2000 Feb 2000 Mar 2000 Apr 2000 May 2000 Jun 2000 Jul 2000 Aug 2000 
#&gt;        1        1        1       NA       NA       NA        3        3 
#&gt; Sep 2000 Oct 2000 Nov 2000 Dec 2000 
#&gt;        3        4        4        4 </div><div class='input'>


</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Christopher Brown.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
